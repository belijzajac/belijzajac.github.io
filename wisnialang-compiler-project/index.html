<!--
                                                                                   .                                                                                                                    
                             @%#####@#                                        @@########@                                                                                                               
                          &###########%@                                    @%%@###########(                                                                                                            
                       @##############%%%@,                               @%%%%@#############,                                                                                                          
                    @########&########%%%%%%@                            %%%%%%%##############@                                                                                                         
                  @##################@%%%%%%%%@                        %%%%%%%%%@###############/                                                                                                       
                @###################@%%%%%%%%%%%@                     %%%%%%%%%%%################@                                                                                                      
              @####################@%%%%%%%%%%%%%%*                 @%%%%%%%%%%%%@################@                                                                                                     
            (%###################@ &%%%%%%%%%%%%%%%@               @%%%%%%%%%%%%%%@################/                                                                                                    
           @###################@# .  @%%%%%%%%%%%%%%%@            @%%%%%%%%%%%%%%%  ################                                                                                                    
         @###################&@        @%%%%%%%%%%%%%%%/         @%%%%%%%%%%%%%&     @##############@                                @*                                                                 
        @##################@@             @%%%%%%%%%%%%%@       @%%%%%%%%%%%%@        @#############@                              @//////@,                                                            
      @##################@                   @%%%%%%%%%%%@     @%%%%%%%%%@              &###########@                           *@    @     #////#                                  @@@@                
    *%###############%@                           @@%%%%@@/  %@%%%%%%@*                  @##########@                         ///////////*     ////                              @////////*             
   @#############&@                             @@.  *     ....,**.   @,                   @########@                      .(////////////((..@@*                                @/////////@             
  @##########@@                             @.    @&    ,..   ,   ......   (                ########@                 @////////////////((@                                     &      ////@             
.%#######@&                              @      .      &             .. ..    @               @#####@                @////////////////(@                                      *       *///@             
#####@#                               /%      .                      #.   .     @.             @####@                @//////////.,///(                                       @ *      @/#(@             
##@                                 @       /   @               #     .          @               @##@                 @            *(/                                      @         /((((             
                                   /           @                ,,                  @                                  @            @                                                 /(@((@            
                                 @           *,@.           * @@(@,@    @           .@                                  @       *//(@                                      @          (@(((@            
                                %           @,,,           .  .,,  ,@   %         .   @                                  */////////(@                                     @///////   ((((..%            
                                      .   .@,,,,, .    .   .  %,     @..,@.      ..  &                                   @/////////(@                                    @/////////(((.....,(           
                               @     .   .(,,,   ,.@   .  .. %,       #./,.........@ . @                                 .          @                                   @      ////....../(((@          
                                    ......,,,  ./  @@  .. .& ,  .///.  .%,#......... .@                                   @         %                                  @         /@...,(((#             
                              @ .  ......@(@,//////*,@....(,( ,,&/////@@@@@...........@ @                                 @    /////(.                               #           &/((((@                
                              @ * .......@@, @/////@ . @../     #//////,@@@..../.../@.@.@                                  /////////(@                              @//////////                         
                              @% .......@,@  @  ...@     .,     @  .. & ,@&........@*.@./                                  @/////////(*                           */////////////,                       
                              @  .....@.#,     &#@               #/.#@    .....   @@*....                                  @/        .#                          @      ///////@                        
                              @  @..../...            &                  @..@....****@...@                                            .@                                     ///                        
                             .    @    / @                          @@  , **/,..@**/@(/@@@&                                     .//////(                      @               @                         
                                  @ @   .@#                           @@   @  @    #/@       @                              @//////////(@                    @/////////      .                          
                                     %,     @@                    ,     ,  @    @ @/@         .,                            @///////////(,                 @///////////////  *                          
                                  @             ,#       .     ,             @   *#/          .@                            %            &                @        /////////@                           
                                  @   ,*         .,@         @                  @#,          ..@                                         .@             .              ////@                            
                                 @       @*        ..@&,&@@,,/              @..@@,          ...@                                      .//((            @                  @                             
                                 #       @         ..##%,,,,,,#         @##@@..@@@,         ..*&////&@@ @#///////#//////////@@///////////((@          /,//////           @,                             
                                       (          ,#####@,(,,,           @(#@...@          .,.,@///////////%@&///////////////*///@@@@/////*@          #//////////////   #                               
                                 (    @          @%*######,,,,,           #..(@.,         ...,,.@@////////////////#////%(////&((@(/@     (/////. #@( @*///////////////(*,                               
                                @    @          @,,###.#####*,,,            ...%,        ....,/.#.@#..   ####@////////@/////(////&//       &//////     /@.       ////((,                                
                              @/////@          @@,*..%.@###/&##@#           ..*&/////////(/%,,@..(* ...#   &#@    //////&(/////////(/        @//////     ///@      ./#                                  
                             @ (///           .@ @@.......@%%%...@           @@//////////////##@*** #....@   #@     (/////@@@(//////(%        (//////      ///    ..@                                   
                            @//@@@           ,.@  @...,@..@..%&%@@@           @/(////(//(/  (##@*** @%.@...@  @@      %////&///(##(///#        @/////      ////*...&                                    
                            @@  @           /..@   ,..*.,.&..@%%%%@..          @/(////(//////#@@*@/.....%  %,  @%     .%//////////@#(/@      ..@/////,     //(((..,                                     
                            @ %            @..*@    ..........%@@%%.@           /..........@###...... ..@@...@  @    ..(////@///////#@@........//////  ....(((((.,                                      
                             @            @@...@     ........@%@%%%/.@            ......   ..@,.........%,../(   %.....,////@/(/////@#,,,,,,,,@((((((....((((((.@                                       
                           @               #...@         @.@.@%&%%%&..@             @..    ......&*#@@@.@.*./. ..&..,,,@####////@////%,,,,,,,@(((((...(((((@%                                           
                          @              @ /..,%            @%%%%%%%...@            .@.   ..@*...#**..@##.& (*@,,@,,,,(####/////(####&,,,,,@(((((.#@.                                                   
                         @              @  %...%            @%%%&%%%....,            .@@ ..@*&%%*/,.@.@@*.@ .@,,,%,,,###%##//(#######@@@@@                                                              
                         (            .@   @...@            &%%@@%%%@...&            ...(....@ /**&.&*,.&..@,*/,*@##@#######@@@@@#                                                                      
                        /            .@    @.,.%           @%%%*@%%%% .//@           ......*.@@(*****/@.*&@&**@@@.                                                                                      
                     ...@         .*      #@.#        %@@#%%%%@ %%%%%@    *         ..@..@*@@@@@@@ .*@ /.*@*@,**/@                                                                                      
                       &      ...@......                         &%######   &,  ........@    ( /@..#@*%.@***@**%                                                                                        
                                                                               .@.......*         @***&*****@                                                                                           
                                                                                                                                                                                                        
-->
<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.126.1"><meta name=description content="belijzajac's personal blog, where he shows off some of his current, past, and future projects as well as shares personal experience of developing projects involving modern C++ and Linux!"><link rel=icon href=https://belijzajac.dev/shimakaze.gif><link rel=stylesheet href=https://belijzajac.dev/css/bootstrap.min.css><link rel=stylesheet href=https://belijzajac.dev/css/font-awesome.min.css><title>WisniaLang: Compiler Project | belijzajac.dev</title><style>.follow-me{position:sticky;margin-right:-380px;width:320px;font-size:.9em;float:right;padding-top:15px;padding-left:15px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;background:#e0dedd;font-size:1rem;box-shadow:1px 1px 2px rgba(0,0,0,.125);word-wrap:break-word;box-sizing:border-box}.table-of-contents{position:sticky;top:2em;margin-right:-380px;width:320px;font-size:1rem;float:right;padding-top:15px;padding-left:15px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;background:#e0dedd;box-shadow:1px 1px 2px rgba(0,0,0,.125);word-wrap:break-word;box-sizing:border-box}.table-of-contents ul{list-style:none;line-height:2;padding-left:15px}.table-of-contents ul ul{margin-bottom:0}.table-of-contents ul li ul{line-height:1.66}.table-of-contents a{color:var(--text-light)}.table-of-contents a:hover{color:var(--text-darkish)}.table-of-contents li.active>a{color:#454545;font-weight:850}.table-of-contents a{transition:all 100ms ease-in-out}@media screen and (max-width:1650px){.table-of-contents{display:none}.follow-me{display:none}}.article-description{font-weight:400;font-size:1.2rem;background:#eaeaea;border-left:3px solid #ccc;padding:.5em 10px}.grid-container{display:grid;grid-template-columns:auto auto auto auto;justify-content:start}.grid-item{font-size:20px;text-align:center}highlight{padding:.2em;background-color:#ffe28e}body{min-width:300px}.navbar{margin-bottom:1em}article{padding-bottom:1em}img{max-width:100%}body{background:#ece9e6;background:-webkit-linear-gradient(to top,#FFFFFF,#ECE9E6);background:linear-gradient(to right,#FFFFFF,#ECE9E6)}body{color:#212529}a{color:#00254f}a:hover,a:focus{color:#000914}.container{max-width:910px}pre{display:block;padding:9.5px;word-break:break-all;word-wrap:break-word;background-color:#ead6d4}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border:none;border-radius:0}code{padding:2px 4px;color:inherit;background-color:#ead6d4;border:1px solid #333;border-radius:4px;font-size:.9em}blockquote,.blockquote{padding:10px 20px;margin:0 0 20px;font-size:1em;border-left:5px solid #6c757d}.footer{text-align:center;color:#7d7d7d}.footer a{color:inherit}.separator{border:0;border-top:3px dashed #000}h1{font-size:2.2rem}</style></head><body><nav class="navbar navbar-expand-md navbar-dark" style=background-color:#222121><div class=container-fluid><button class="navbar-toggler navbar-toggler-right border-0 p-0" type=button data-toggle=collapse data-target=#navbar20>
<span class=navbar-toggler-icon></span><p class="navbar-brand text-white mb-0">&nbsp;belijzajac.dev</p></button><div class="collapse navbar-collapse" id=navbar20><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/>Posts</a></li></ul><p class="d-none d-md-block lead mb-0 text-white"><b>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;belijzajac.dev</b></p><ul class="navbar-nav ml-auto"><li class="nav-item mx-1"><a class=nav-link href=https://github.com/belijzajac target=_blank rel=noopener><i class="fa fa-github fa-fw fa-lg"></i></a></li><li class="nav-item mx-1"><a class=nav-link href=https://twitter.com/belijzajac target=_blank rel=noopener><i class="fa fa-twitter fa-fw fa-lg"></i></a></li><li class="nav-item mx-1"><a class=nav-link href=mailto:blog@belijzajac.dev><i class="fa fa-envelope-o fa-fw fa-lg"></i></a></li><li class="nav-item mx-1"><a class=nav-link href=/index.xml target=_blank rel=noopener><i class="fa fa-rss fa-fw fa-lg"></i></a></li></ul></div></div></nav><div class=container><article><h1>WisniaLang: Compiler Project</h1><h3 class=article-description>Can we produce small and fast binaries at the same time?</h3><p><small class=text-secondary>Oct 17, 2022
</small><small><code><a href=https://belijzajac.dev/tags/c++>c++</a></code></small>
<small><code><a href=https://belijzajac.dev/tags/elf>elf</a></code></small>
<small><code><a href=https://belijzajac.dev/tags/compiler>compiler</a></code></small>
<small><code><a href=https://belijzajac.dev/tags/llvm>llvm</a></code></small>
<small><code><a href=https://belijzajac.dev/tags/rust>rust</a></code></small></p><div class=table-of-contents><h5><b>CONTENTS</b></h5><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#architecture>Architecture</a></li><li><a href=#programming-languages-and-llvm>Programming languages and LLVM</a></li><li><a href=#benchmark-no-1-fibonacci-sequence>Benchmark No. 1: Fibonacci sequence</a><ul><li><a href=#wisnialang-benchmark>WisniaLang benchmark</a></li><li><a href=#c-gcc-benchmark>C++ (gcc) benchmark</a></li><li><a href=#c-clang-benchmark>C++ (clang) benchmark</a></li><li><a href=#rust-benchmark>Rust benchmark</a></li></ul></li><li><a href=#benchmark-no-2-29988-lines-of-code>Benchmark No. 2: 29'988 lines of code</a><ul><li><a href=#wisnialang-benchmark-1>WisniaLang benchmark</a></li><li><a href=#c-gcc-benchmark-1>C++ (gcc) benchmark</a></li><li><a href=#c-clang-benchmark-1>C++ (clang) benchmark</a></li><li><a href=#rust-benchmark-1>Rust benchmark</a></li></ul></li><li><a href=#results>Results</a></li><li><a href=#summary>Summary</a></li></ul></nav></div><div class=follow-me><h5><b>FOLLOW ME</b></h5><div class=grid-container><div class=grid-item><a class=nav-link href=https://github.com/belijzajac target=_blank rel=noopener><i class="fa fa-github fa-fw fa-lg"></i></a></div><div class=grid-item><a class=nav-link href=https://twitter.com/belijzajac target=_blank rel=noopener><i class="fa fa-twitter fa-fw fa-lg"></i></a></div><div class=grid-item><a class=nav-link href=mailto:blog@belijzajac.dev><i class="fa fa-envelope-o fa-fw fa-lg"></i></a></div><div class=grid-item><a class=nav-link href=/index.xml target=_blank rel=noopener><i class="fa fa-rss fa-fw fa-lg"></i></a></div></div></div><script>const tableOfContents=document.querySelector(".table-of-contents"),followMe=document.querySelector(".follow-me");function updateFollowMePosition(){const e=tableOfContents.getBoundingClientRect();followMe.style.top=e.bottom+40+"px"}updateFollowMePosition(),window.addEventListener("scroll",updateFollowMePosition),window.addEventListener("resize",updateFollowMePosition)</script><p><img src=/post-images/dragon-maid-compiler-book.jpg alt=dragon-book></p><h2 id=introduction>Introduction</h2><p>For the past 3 years, I have been working on the <highlight><a href=https://github.com/belijzajac/WisniaLang>WisniaLang</a></highlight> compiler for my own programming language that compiles to native machine code and packs it into an executable by itself. Unlike many others, I rolled out my own compiler backend from scratch that does fast but naive code generation. While it&rsquo;s admittedly a more old-fashioned approach to compiler engineering, it&rsquo;s the path I chose to take when developing my compiler.</p><h2 id=architecture>Architecture</h2><p><img src=/post-images/wisnialang-architecture.png alt=architecture></p><p>My compiler&rsquo;s architecture is divided into several main phases that work together to complete this translation. These phases include lexical analysis, which breaks the source code down into smaller pieces called tokens; syntactic analysis, which builds a representation of the structure of the source code called an abstract syntax tree (AST); semantic analysis, which checks the AST for semantic errors while traversing the tree; intermediate representation (IR), which represents the code in a lower-level form close to the target architecture; code generation, which allocates registers and generates machine code from the said IRs; and, lastly, packing the resulting machine code into an executable program in ELF format.</p><h2 id=programming-languages-and-llvm>Programming languages and LLVM</h2><p>Before going further, let me get straight to the point:</p><ol><li>Writing compilers is easy</li><li>Optimizing the machine code is hard</li><li>Supporting arbitrary architectures / operating systems is hard</li></ol><p><img src=/post-images/llvm-approach.png alt=llvm-approach></p><p>This is where LLVM comes in handy. LLVM uses an intermediate representation language, which is kind of similar to assembly, but with a few higher level constructs. LLVM is good at optimizing this IR language, as well as compiling into different architecture and binary formats. So as a language author using LLVM, I&rsquo;m really writing a transpiler from my language to LLVM IR, and letting the LLVM compiler do the hard work.</p><hr><p>You talk about LLVM so much, why&rsquo;s that? Let me begin with this illustration:</p><p><img src=/post-images/llvm-family.png alt=llvm-family></p><p>I&rsquo;m not sure if it&rsquo;s a positive thing, but the LLVM project has achieved such widespread adoption that it&rsquo;s almost reached a monopoly status, much like the Chromium project, for instance. Apart from Google Chrome, numerous other browsers are built upon the Chromium codebase. From Electron web apps to Arc, Microsoft Edge, Opera, Vivaldi, Brave, and beyond, the list just goes on. Firefox and Safari are perhaps the only web browsers that stand out from this copy-paste crowd.</p><p>I just wanted to point out that while 99.9% of compiler developers opt for LLVM, the remaining few explore alternative compiler backends like <highlight><a href=https://c9x.me/compile/>QBE</a></highlight>, develop interpreters (like Python), or create virtual machines (such as the JVM for Java and Kotlin). Some even write transpilers that convert high-level languages into something low-level like C, which is then compiled with gcc. If you recall the dragon compiler book appearing at the top of this page, these and similar compiler books are gradually losing relevance because they don&rsquo;t teach how to use LLVM, the industry&rsquo;s compiler standard.</p><h2 id=benchmark-no-1-fibonacci-sequence>Benchmark No. 1: Fibonacci sequence</h2><p>To benchmark different compilers, I chose the Fibonacci sequence without recursion problem and computed the 46th Fibonacci number with each compiler under test. This number was chosen because it conveniently fits within 32 bits. Compile-time and runtime benchmarks were performed using the <highlight><a href=https://github.com/sharkdp/hyperfine>hyperfine</a></highlight> command-line benchmarking tool, which closely resembles Rust&rsquo;s <highlight><a href=https://github.com/bheisler/criterion.rs>Criterion</a></highlight> benchmarking library. Binary size benchmarks were carried out using standard Linux tools like <code>strip</code> to remove debug symbols from binaries and <code>wc</code> to display byte counts for each binary file.</p><h3 id=wisnialang-benchmark>WisniaLang benchmark</h3><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 1</span><span><span style=color:#fe8019>fn</span> <span style=color:#fabd2f>fibonacci</span>(n: int) -&gt; int {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 2</span><span>  <span style=color:#fe8019>if</span> (n <span style=color:#fe8019>&lt;=</span> <span style=color:#d3869b>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 3</span><span>    <span style=color:#fe8019>return</span> n;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 4</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 5</span><span>  int prev <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 6</span><span>  int current <span style=color:#fe8019>=</span> <span style=color:#d3869b>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 7</span><span>  <span style=color:#fe8019>for</span> (int i <span style=color:#fe8019>=</span> <span style=color:#d3869b>2</span>; i <span style=color:#fe8019>&lt;=</span> n; i <span style=color:#fe8019>=</span> i <span style=color:#fe8019>+</span> <span style=color:#d3869b>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 8</span><span>    int next <span style=color:#fe8019>=</span> prev <span style=color:#fe8019>+</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 9</span><span>    prev <span style=color:#fe8019>=</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">10</span><span>    current <span style=color:#fe8019>=</span> next;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">11</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">12</span><span>  <span style=color:#fe8019>return</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">15</span><span><span style=color:#fe8019>fn</span> <span style=color:#fabd2f>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">16</span><span>  print(fibonacci(<span style=color:#d3869b>46</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">17</span><span>}
</span></span></code></pre></div><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>1000</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;./wisnia fibonacci.wsn&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: ./wisnia fibonacci.wsn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:       1.6 ms ±   0.3 ms    <span style=color:#fe8019>[</span>User: 0.8 ms, System: 0.5 ms<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:     1.3 ms …   8.7 ms    <span style=color:#d3869b>1000</span> runs
</span></span></code></pre></div><h4>Runtime</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>1000</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;./a.out&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: ./a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     109.6 µs ±  36.8 µs    <span style=color:#fe8019>[</span>User: 58.2 µs, System: 4.7 µs<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:    84.0 µs … 736.3 µs    <span style=color:#d3869b>1000</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>wc -c a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#d3869b>421</span> a.out
</span></span></code></pre></div><h3 id=c-gcc-benchmark>C++ (gcc) benchmark</h3><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 1</span><span><span style=color:#8ec07c>#include</span> <span style=color:#8ec07c;font-style:italic>&lt;iostream&gt;</span><span style=color:#8ec07c>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 2</span><span><span style=color:#8ec07c></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 3</span><span><span style=color:#fe8019>constexpr</span> <span style=color:#fe8019>auto</span> <span style=color:#fabd2f>fibonacci</span>(u_int32_t n) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 4</span><span>  <span style=color:#fe8019>if</span> (n <span style=color:#fe8019>&lt;=</span> <span style=color:#d3869b>1</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 5</span><span>    <span style=color:#fe8019>return</span> n;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 6</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 7</span><span>  u_int32_t prev <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span>, current <span style=color:#fe8019>=</span> <span style=color:#d3869b>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 8</span><span>  <span style=color:#fe8019>for</span> (size_t i <span style=color:#fe8019>=</span> <span style=color:#d3869b>2</span>; i <span style=color:#fe8019>&lt;=</span> n; i<span style=color:#fe8019>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 9</span><span>    u_int32_t next <span style=color:#fe8019>=</span> prev <span style=color:#fe8019>+</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">10</span><span>    prev <span style=color:#fe8019>=</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">11</span><span>    current <span style=color:#fe8019>=</span> next;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">12</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">13</span><span>  <span style=color:#fe8019>return</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">16</span><span><span style=color:#fabd2f>int</span> <span style=color:#fabd2f>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">17</span><span>  std<span style=color:#fe8019>::</span>printf(<span style=color:#b8bb26>&#34;%d&#34;</span>, fibonacci(<span style=color:#d3869b>46</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">18</span><span>}
</span></span></code></pre></div><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>100</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;gcc -std=c++23 -O3 fibonacci.cpp&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: gcc -std<span style=color:#fe8019>=</span>c++23 -O3 fibonacci.cpp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     456.4 ms ±   4.5 ms    <span style=color:#fe8019>[</span>User: 415.8 ms, System: 35.2 ms<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:   448.9 ms … 472.1 ms    <span style=color:#d3869b>100</span> runs
</span></span></code></pre></div><h4>Runtime</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>1000</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;./a.out&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: ./a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     347.1 µs ±  62.8 µs    <span style=color:#fe8019>[</span>User: 206.4 µs, System: 67.2 µs<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:   271.9 µs … 926.4 µs    <span style=color:#d3869b>1000</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>strip a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>wc -c a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#d3869b>14472</span> a.out
</span></span></code></pre></div><h3 id=c-clang-benchmark>C++ (clang) benchmark</h3><p>Same program as before, just different compiler.</p><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>100</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;clang -std=c++2b -O3 fibonacci.cpp&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: clang -std<span style=color:#fe8019>=</span>c++2b -O3 fibonacci.cpp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     538.2 ms ±  16.9 ms    <span style=color:#fe8019>[</span>User: 481.7 ms, System: 45.7 ms<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:   524.3 ms … 657.9 ms    <span style=color:#d3869b>100</span> runs
</span></span></code></pre></div><h4>Runtime</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>1000</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;./a.out&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: ./a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     351.4 µs ±  67.7 µs    <span style=color:#fe8019>[</span>User: 203.2 µs, System: 72.2 µs<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:   267.1 µs … 984.8 µs    <span style=color:#d3869b>1000</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>strip a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>wc -c a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#d3869b>14504</span> a.out
</span></span></code></pre></div><h3 id=rust-benchmark>Rust benchmark</h3><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 1</span><span><span style=color:#fe8019>fn</span> <span style=color:#fabd2f>fibonacci</span>(n: <span style=color:#fabd2f>u32</span>) -&gt; <span style=color:#fabd2f>u32</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 2</span><span>  <span style=color:#fe8019>if</span> n <span style=color:#fe8019>&lt;=</span> <span style=color:#d3869b>1</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 3</span><span>    <span style=color:#fe8019>return</span> n;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 4</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 5</span><span>  <span style=color:#fe8019>let</span> (<span style=color:#fe8019>mut</span> prev, <span style=color:#fe8019>mut</span> current) <span style=color:#fe8019>=</span> (<span style=color:#d3869b>0</span>, <span style=color:#d3869b>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 6</span><span>  <span style=color:#fe8019>for</span> _ <span style=color:#fe8019>in</span> <span style=color:#d3869b>2</span><span style=color:#fe8019>..=</span>n {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 7</span><span>    <span style=color:#fe8019>let</span> next <span style=color:#fe8019>=</span> prev <span style=color:#fe8019>+</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 8</span><span>    prev <span style=color:#fe8019>=</span> current;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 9</span><span>    current <span style=color:#fe8019>=</span> next;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">10</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">11</span><span>  current
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">14</span><span><span style=color:#fe8019>fn</span> <span style=color:#fabd2f>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">15</span><span>  println!(<span style=color:#b8bb26>&#34;</span><span style=color:#b8bb26>{}</span><span style=color:#b8bb26>&#34;</span>, fibonacci(<span style=color:#d3869b>46</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">16</span><span>}
</span></span></code></pre></div><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>100</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;rustc -C opt-level=3 fibonacci.rs&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: rustc -C opt-level<span style=color:#fe8019>=</span><span style=color:#d3869b>3</span> fibonacci.rs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     173.4 ms ±   3.0 ms    <span style=color:#fe8019>[</span>User: 130.5 ms, System: 51.2 ms<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:   168.6 ms … 183.8 ms    <span style=color:#d3869b>100</span> runs
</span></span></code></pre></div><h4>Runtime</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>1000</span> --warmup <span style=color:#d3869b>10</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;./fibonacci&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: ./fibonacci
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:     490.4 µs ±  82.8 µs    <span style=color:#fe8019>[</span>User: 264.9 µs, System: 129.3 µs<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:   375.1 µs … 1092.6 µs    <span style=color:#d3869b>1000</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>strip fibonacci
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>wc -c fibonacci
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#d3869b>321920</span> fibonacci
</span></span></code></pre></div><h2 id=benchmark-no-2-29988-lines-of-code>Benchmark No. 2: 29'988 lines of code</h2><p>I wrote a <highlight><a href=/post-data/main.py>Python script</a></highlight> that generates program code for WisniaLang, C++, and Rust. It generates similar calls to a function named <code>calculate_1997</code>, such as <code>calculate_1</code>, <code>calculate_2</code>, and <code>calculate_1999</code>, for over 2000 times:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 1</span><span>...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 2</span><span><span style=color:#fabd2f>void</span> calculate_1997() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 3</span><span>  <span style=color:#fabd2f>int</span> i <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 4</span><span>  <span style=color:#fabd2f>int</span> a <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 5</span><span>  <span style=color:#fabd2f>int</span> b <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 6</span><span>  <span style=color:#fe8019>while</span> (b <span style=color:#fe8019>&lt;</span> <span style=color:#d3869b>1997</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 7</span><span>    a <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 8</span><span>    b <span style=color:#fe8019>=</span> a <span style=color:#fe8019>-</span> b <span style=color:#fe8019>-</span> i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59"> 9</span><span>    <span style=color:#fabd2f>int</span> c <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">10</span><span>    <span style=color:#fabd2f>int</span> d <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> c;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">11</span><span>    <span style=color:#fabd2f>int</span> e <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> c <span style=color:#fe8019>+</span> d;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">12</span><span>    <span style=color:#fabd2f>int</span> f <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> c <span style=color:#fe8019>+</span> d <span style=color:#fe8019>+</span> e;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">13</span><span>    i <span style=color:#fe8019>=</span> f <span style=color:#fe8019>-</span> e <span style=color:#fe8019>-</span> d <span style=color:#fe8019>-</span> c <span style=color:#fe8019>+</span> <span style=color:#d3869b>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">14</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">15</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">16</span><span>...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">17</span><span><span style=color:#fabd2f>int</span> main() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">18</span><span>  ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">19</span><span>  calculate_1997();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">20</span><span>  ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">21</span><span>}
</span></span></code></pre></div><p>You can run this script with <code>python3.7 main.py --wisnia --cpp --rust 2000</code>.</p><h3 id=wisnialang-benchmark-1>WisniaLang benchmark</h3><p>The program can be found at <highlight><a href=/post-data/calculate.wsn>post-data/calculate.wsn</a></highlight>.</p><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>20</span> --warmup <span style=color:#d3869b>1</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;./wisnia calculate.wsn&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: ./wisnia calculate.wsn
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:      2.367 s ±  0.054 s    <span style=color:#fe8019>[</span>User: 2.328 s, System: 0.036 s<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:    2.282 s …  2.466 s    <span style=color:#d3869b>20</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>wc -c a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span><span style=color:#d3869b>336025</span> a.out
</span></span></code></pre></div><h3 id=c-gcc-benchmark-1>C++ (gcc) benchmark</h3><p>The program can be found at <highlight><a href=/post-data/calculate.cpp>post-data/calculate.cpp</a></highlight>.</p><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>20</span> --warmup <span style=color:#d3869b>1</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;gcc -std=c++23 -O3 calculate.cpp&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: gcc -std<span style=color:#fe8019>=</span>c++23 -O3 calculate.cpp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:      2.177 s ±  0.009 s    <span style=color:#fe8019>[</span>User: 2.110 s, System: 0.064 s<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:    2.156 s …  2.193 s    <span style=color:#d3869b>20</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>strip a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>wc -c a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#d3869b>96304</span> a.out
</span></span></code></pre></div><h3 id=c-clang-benchmark-1>C++ (clang) benchmark</h3><p>Same program as before, just different compiler.</p><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>20</span> --warmup <span style=color:#d3869b>1</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;clang -std=c++2b -O3 calculate.cpp&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: clang -std<span style=color:#fe8019>=</span>c++2b -O3 calculate.cpp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:      2.179 s ±  0.025 s    <span style=color:#fe8019>[</span>User: 2.125 s, System: 0.048 s<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:    2.156 s …  2.252 s    <span style=color:#d3869b>20</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>strip a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>wc -c a.out
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#d3869b>96336</span> a.out
</span></span></code></pre></div><h3 id=rust-benchmark-1>Rust benchmark</h3><p>The program can be found at <highlight><a href=/post-data/calculate.rs>post-data/calculate.rs</a></highlight>.</p><h4>Compile time</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>hyperfine --runs <span style=color:#d3869b>20</span> --warmup <span style=color:#d3869b>1</span> --shell<span style=color:#fe8019>=</span>none <span style=color:#b8bb26>&#39;rustc -C opt-level=3 calculate.rs&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>Benchmark 1: rustc -C opt-level<span style=color:#fe8019>=</span><span style=color:#d3869b>3</span> calculate.rs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  Time <span style=color:#fe8019>(</span>mean ± σ<span style=color:#fe8019>)</span>:      2.353 s ±  0.027 s    <span style=color:#fe8019>[</span>User: 2.268 s, System: 0.095 s<span style=color:#fe8019>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  Range <span style=color:#fe8019>(</span>min … max<span style=color:#fe8019>)</span>:    2.324 s …  2.436 s    <span style=color:#d3869b>20</span> runs
</span></span></code></pre></div><h4>Binary size</h4><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span>strip calculate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>wc -c calculate
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span><span style=color:#d3869b>317824</span> calculate
</span></span></code></pre></div><h2 id=results>Results</h2><p>Combining mean compile time, runtime, and binary sizes from benchmark results, we obtain the following graphs.</p><p><img src=/post-images/benchmark-1.png alt=benchmark-results-1></p><p>The runtime range for WisniaLang was from <code>84.0 µs</code> to <code>736.3 µs</code> over 1000 program runs, indicating ambiguous results due to benchmarking a 17-line program that executes 3 lines of code 45 times. However, this does demonstrate the speed at which we can compile small programs. In the future, I plan to report on the recursive Fibonacci sequence.</p><p><img src=/post-images/benchmark-2.png alt=benchmark-results-1></p><p>WisniaLang generates code as fast as established compilers, but this may be because it doesn&rsquo;t perform many static code analysis or optimization steps. This has resulted in my binary being quite large. In contrast, C++ optimizes out redundant code, simplifying the while loop to use at most three variables. This is the while loop in question:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">1</span><span><span style=color:#fe8019>while</span> (b <span style=color:#fe8019>&lt;</span> <span style=color:#d3869b>1997</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">2</span><span>  a <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">3</span><span>  b <span style=color:#fe8019>=</span> a <span style=color:#fe8019>-</span> b <span style=color:#fe8019>-</span> i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">4</span><span>  <span style=color:#fabd2f>int</span> c <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">5</span><span>  <span style=color:#fabd2f>int</span> d <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> c;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">6</span><span>  <span style=color:#fabd2f>int</span> e <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> c <span style=color:#fe8019>+</span> d;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">7</span><span>  <span style=color:#fabd2f>int</span> f <span style=color:#fe8019>=</span> a <span style=color:#fe8019>+</span> b <span style=color:#fe8019>+</span> c <span style=color:#fe8019>+</span> d <span style=color:#fe8019>+</span> e;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">8</span><span>  i <span style=color:#fe8019>=</span> f <span style=color:#fe8019>-</span> e <span style=color:#fe8019>-</span> d <span style=color:#fe8019>-</span> c <span style=color:#fe8019>+</span> <span style=color:#d3869b>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#756d59">9</span><span>}
</span></span></code></pre></div><p>What I mean is that C++ likely optimized the code to use only three variables &ndash; <code>a</code>, <code>b</code>, and <code>i</code> &ndash; by substituting the values of <code>c</code>, <code>d</code>, <code>e</code>, and <code>f</code> directly, thereby reducing redundancy. This is something I&rsquo;ll fix in the later releases of WisniaLang.</p><h2 id=summary>Summary</h2><ul><li>If compilation speed and binary size are important, dropping the LLVM toolchain can have a positive impact</li><li>However, doing so means missing out on LLVM optimizations as well as support for arbitrary OSes and architectures</li></ul><div class=separator></div><br><div class=media><div class=media-left><img src=https://belijzajac.dev/author.jpg alt=selfie class="mr-3 mt-3 rounded-circle" style="border:2px solid #d8d8d8;border-radius:50%"></div><div class=media-body><h4 class=media-heading>The author behind this post</h4>Hi there! My online handle is belijzajac, which translates to "white hare" in Russian. I'm a software developer with a strong passion for C++20, Rust, Linux, and compilers. With a solid foundation in these technologies, I'm always looking for new ways to challenge myself and grow as a developer. In my free time, you can find me tinkering with new technologies and keeping up to date with the latest industry trends. Thank you for visiting my blog!</div></div><br><div class=separator></div><br><script src=https://giscus.app/client.js data-repo=belijzajac/belijzajac.github.io data-repo-id=R_kgDOGjWVjg data-category=Announcements data-category-id=DIC_kwDOGjWVjs4Cco4S data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the comments powered by giscus</noscript><script src=https://belijzajac.dev/js/toc.js></script></article><script type=application/javascript>countDownDate=new Date("2021-12-23");var x=setInterval(function(){var s=(new Date).getTime(),e=s-countDownDate.getTime(),t=Math.floor(e/(365*1e3*60*60*24)),o=Math.floor(e/(1e3*60*60*24)-(t>0?365*t:0)),i=Math.floor(e%(1e3*60*60*24)/(1e3*60*60)),a=Math.floor(e%(1e3*60*60)/(1e3*60)),n=Math.floor(e%(1e3*60)/1e3);document.getElementById("demo").innerHTML=(t>0?t+"y ":"")+o+"d "+i+"h "+a+"m "+(n>9?n:"0"+n)+"s "},1e3)</script><footer class=footer><span>Website is running for <tag id=demo></tag><br>Copyright © 2024
<a href=https://github.com/belijzajac target=_blank rel=noopener>belijzajac</a>
| <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span></footer><br></div><script src=https://belijzajac.dev/js/jquery-3.3.1.slim.min.js></script><script src=https://belijzajac.dev/js/bootstrap.bundle.min.js></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-217331412-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>